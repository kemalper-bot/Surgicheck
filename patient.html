<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SurgiCheck | Hasta Ã–n DeÄŸerlendirme</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 min-h-screen">
  <div class="max-w-3xl mx-auto p-4 sm:p-6">

    <div class="bg-white rounded-xl shadow p-5 sm:p-6 mb-6">
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-5 border-b border-slate-100 pb-5">
        
        <div class="flex items-center gap-4 sm:gap-5">
          <img src="logo.png" alt="SurgiCheck Logo" class="h-14 sm:h-20 object-contain flex-shrink-0" />
          <div class="border-l-2 border-slate-100 pl-4 sm:pl-5">
            <h1 class="text-xl sm:text-2xl font-bold text-slate-800 tracking-tight leading-snug">Preoperatif Risk Analizi</h1>
            <p class="text-sm text-slate-500 font-medium mt-0.5">Leo Klinik</p>
          </div>
        </div>

        <div class="flex flex-col items-start md:items-end gap-3 w-full md:w-auto">
          <div class="flex bg-slate-100 p-1 rounded-lg border border-slate-200 self-end">
            <a href="patient.html" class="px-4 py-1.5 text-xs font-bold bg-white text-slate-900 rounded shadow-sm cursor-default">ğŸ‡¹ğŸ‡· TR</a>
            <a href="patient-en.html" class="px-4 py-1.5 text-xs font-medium text-slate-500 hover:text-slate-800 transition-colors">ğŸ‡¬ğŸ‡§ EN</a>
          </div>
          <div class="text-[11px] sm:text-xs text-slate-500 text-left md:text-right bg-slate-50 p-2.5 rounded-lg border border-slate-100 w-full md:w-auto">
            Bu form tanÄ± koymaz. <span class="font-bold text-slate-700">Nihai karar klinisyene aittir.</span>
          </div>
        </div>

      </div>

      <div class="mt-8">
        <div class="flex items-center gap-0">
          <div class="step-item flex items-center gap-2 flex-1">
            <div id="dot-1" class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-black text-white flex-shrink-0">1</div>
            <div class="text-xs text-slate-600 hidden sm:block font-medium">KiÅŸisel & ProsedÃ¼r</div>
            <div class="flex-1 h-px bg-slate-200 mx-2"></div>
          </div>
          <div class="step-item flex items-center gap-2 flex-1">
            <div id="dot-2" class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-slate-200 text-slate-500 flex-shrink-0">2</div>
            <div class="text-xs text-slate-400 hidden sm:block font-medium">SaÄŸlÄ±k & Ä°laÃ§lar</div>
            <div class="flex-1 h-px bg-slate-200 mx-2"></div>
          </div>
          <div class="step-item flex items-center gap-2 flex-1">
            <div id="dot-3" class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-slate-200 text-slate-500 flex-shrink-0">3</div>
            <div class="text-xs text-slate-400 hidden sm:block font-medium">AlÄ±ÅŸkanlÄ±klar</div>
            <div class="flex-1 h-px bg-slate-200 mx-2"></div>
          </div>
          <div class="step-item flex items-center gap-2">
            <div id="dot-4" class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-slate-200 text-slate-500 flex-shrink-0">4</div>
            <div class="text-xs text-slate-400 hidden sm:block font-medium">Beklentiler & Onay</div>
          </div>
        </div>
      </div>
    </div>

    <div id="alert" class="hidden mb-4 rounded-lg p-4 text-sm font-medium shadow-sm"></div>

    <div id="sec-1" class="bg-white rounded-xl shadow p-8 mb-4">
      <h2 class="font-bold text-xl mb-6 text-slate-800">KiÅŸisel Bilgiler ve ProsedÃ¼r</h2>
      
      <div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-8">
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">Planlanan ProsedÃ¼r *</label>
          <select id="procedure" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black bg-white">
            <option value="" disabled selected>SeÃ§iniz...</option>
            <option value="Rinoplasti">Rinoplasti</option>
            <option value="Blefaroplasti">Blefaroplasti</option>
            <option value="Breast Lift">Breast Lift</option>
            <option value="Meme BÃ¼yÃ¼tme">Meme BÃ¼yÃ¼tme</option>
            <option value="Meme KÃ¼Ã§Ã¼ltme">Meme KÃ¼Ã§Ã¼ltme</option>
            <option value="Liposuction">Liposuction</option>
            <option value="Tummy Tuck">Tummy Tuck (KarÄ±n Germe)</option>
            <option value="BBL">BBL</option>
            <option value="Facelift">Facelift</option>
            <option value="DiÄŸer">DiÄŸer</option>
          </select>
        </div>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">AynÄ± bÃ¶lgede Ã¶nceki ameliyat var mÄ±? *</label>
          <select id="revision" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black bg-white">
            <option value="no">HayÄ±r</option>
            <option value="yes">Evet â€” revizyon</option>
          </select>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">Ad Soyad *</label>
          <input id="fullName" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="Ad Soyad" />
        </div>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">Telefon *</label>
          <input id="phone" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="+90 5XX XXX XX XX" />
        </div>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">E-posta * <span class="text-xs text-slate-500 font-normal">(Bilgilendirmeler iÃ§in)</span></label>
          <input id="email" type="email" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="email@ornek.com" />
        </div>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">YaÅŸ *</label>
          <input id="age" type="number" min="16" max="100" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="35" />
        </div>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">Boy (cm) *</label>
          <input id="heightCm" type="number" min="1.20" step="any" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="Ã–rn: 165 veya 1.65" />
        </div>
        <div>
          <label class="text-sm font-medium text-slate-700 mb-1 block">Kilo (kg) *</label>
          <input id="weightKg" type="number" min="35" max="250" step="any" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="70" />
        </div>
      </div>
      <div id="bmi-display" class="hidden mt-4 rounded-lg bg-slate-100 border border-slate-200 p-4 text-sm text-slate-700 flex items-center gap-2">
        <svg class="w-5 h-5 text-slate-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
        <span>Hesaplanan VÃ¼cut Kitle Ä°ndeksi (BMI): <strong id="bmi-val" class="text-slate-900 text-base"></strong> <span id="bmi-note" class="text-slate-600 ml-1"></span></span>
      </div>
      <div class="mt-8 flex justify-end">
        <button onclick="nextStep(1)" class="rounded-lg bg-black text-white px-6 py-3 text-sm font-bold hover:bg-slate-800 transition-colors shadow-md">Devam Et â†’</button>
      </div>
    </div>

    <div id="sec-2" class="hidden bg-white rounded-xl shadow p-8 mb-4">
      <h2 class="font-bold text-xl mb-1 text-slate-800">SaÄŸlÄ±k GeÃ§miÅŸi ve Ä°laÃ§lar</h2>
      <p class="text-sm text-slate-500 mb-6">Operasyon risklerini doÄŸru deÄŸerlendirebilmemiz iÃ§in lÃ¼tfen eksiksiz doldurun.</p>

      <div class="space-y-8">
        
        <div class="rounded-xl border border-blue-200 bg-blue-50/60 p-5 shadow-sm">
          <div class="flex items-center gap-2 mb-3">
             <svg class="w-5 h-5 text-blue-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
             <label class="text-base font-bold text-blue-900">DÃ¼zenli KullanÄ±lan Ã–nemli Ä°laÃ§ GruplarÄ±</label>
          </div>
          <p class="text-sm text-blue-700/80 mb-4 leading-relaxed">AÅŸaÄŸÄ±daki ilaÃ§ gruplarÄ±ndan herhangi birini kullanÄ±yorsanÄ±z (veya yakÄ±n zamanda bÄ±raktÄ±ysanÄ±z) lÃ¼tfen iÅŸaretleyiniz:</p>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 mt-2">
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-blue-100 hover:border-blue-300 transition-colors shadow-sm"><input type="checkbox" id="med_bloodThinners" class="accent-blue-600 w-5 h-5" /> <span class="text-sm font-medium text-slate-700">Kan SulandÄ±rÄ±cÄ± (Aspirin, Coraspin, Plavix vb.)</span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-blue-100 hover:border-blue-300 transition-colors shadow-sm"><input type="checkbox" id="med_ocp" class="accent-blue-600 w-5 h-5" /> <span class="text-sm font-medium text-slate-700">DoÄŸum Kontrol / Hormon (Yazz, Microgynon vb.)</span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-blue-100 hover:border-blue-300 transition-colors shadow-sm"><input type="checkbox" id="med_glp1" class="accent-blue-600 w-5 h-5" /> <span class="text-sm font-medium text-slate-700">ZayÄ±flama Ä°ÄŸnesi/Ä°lacÄ± (Ozempic, Saxenda vb.)</span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-blue-100 hover:border-blue-300 transition-colors shadow-sm"><input type="checkbox" id="med_acne" class="accent-blue-600 w-5 h-5" /> <span class="text-sm font-medium text-slate-700">AÄŸÄ±r Akne Ä°lacÄ± (Roaccutane, Zoretanin vb.)</span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-blue-100 hover:border-blue-300 transition-colors shadow-sm"><input type="checkbox" id="med_psych" class="accent-blue-600 w-5 h-5" /> <span class="text-sm font-medium text-slate-700">Psikiyatrik Ä°laÃ§ (Antidepresan, Xanax vb.)</span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-blue-100 hover:border-blue-300 transition-colors shadow-sm"><input type="checkbox" id="med_steroid" class="accent-blue-600 w-5 h-5" /> <span class="text-sm font-medium text-slate-700">Kortizon / Steroid Tedavisi</span></label>
          </div>
          <div class="mt-5">
            <label class="text-sm font-medium text-slate-700 mb-1 block">DiÄŸer DÃ¼zenli Ä°laÃ§lar / Takviyeler</label>
            <input id="med_other" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-blue-400 focus:ring-1 focus:ring-blue-400 bg-white" placeholder="Tansiyon, tiroid ilaÃ§larÄ±, vitaminler vb. isimlerini yazÄ±nÄ±z..." />
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50/30 hover:bg-slate-50 transition-colors">
            <label class="text-sm font-bold text-slate-800">Kardiyak HastalÄ±k</label>
            <p class="text-xs text-slate-500 mb-3 leading-snug">Kalp yetmezliÄŸi, kapak hastalÄ±ÄŸÄ±, ritim bozukluÄŸu, kriz geÃ§miÅŸi.</p>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="cardiac" value="no" checked class="accent-black w-4 h-4" /> <span class="text-sm font-medium">HayÄ±r</span></label>
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="cardiac" value="yes" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">Evet</span></label>
            </div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50/30 hover:bg-slate-50 transition-colors">
            <label class="text-sm font-bold text-slate-800">DVT / Pulmoner Emboli</label>
            <p class="text-xs text-slate-500 mb-3 leading-snug">Bacakta derin ven trombozu (pÄ±htÄ±) veya akciÄŸere pÄ±htÄ± atma Ã¶ykÃ¼sÃ¼.</p>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="dvt" value="no" checked class="accent-black w-4 h-4" /> <span class="text-sm font-medium">HayÄ±r</span></label>
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="dvt" value="yes" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">Evet</span></label>
            </div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50/30 hover:bg-slate-50 transition-colors">
            <label class="text-sm font-bold text-slate-800">Diyabet (Åeker HastalÄ±ÄŸÄ±)</label>
            <p class="text-xs text-slate-500 mb-3 leading-snug">Tip 1 veya Tip 2 diyabet tanÄ±sÄ±.</p>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="diabetes" value="no" checked class="accent-black w-4 h-4" /> <span class="text-sm font-medium">HayÄ±r</span></label>
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="diabetes" value="yes" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">Evet</span></label>
            </div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50/30 hover:bg-slate-50 transition-colors">
            <label class="text-sm font-bold text-slate-800">Hipertansiyon</label>
            <p class="text-xs text-slate-500 mb-3 leading-snug">TanÄ± konulmuÅŸ tansiyon yÃ¼ksekliÄŸi (ilaÃ§ kullansanÄ±z dahi).</p>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="ht" value="no" checked class="accent-black w-4 h-4" /> <span class="text-sm font-medium">HayÄ±r</span></label>
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="ht" value="yes" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">Evet</span></label>
            </div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50/30 hover:bg-slate-50 transition-colors">
            <label class="text-sm font-bold text-slate-800">Aktif Malignite (Kanser)</label>
            <p class="text-xs text-slate-500 mb-3 leading-snug">Devam eden kanser tedavisi veya yakÄ±n zamanda tanÄ±.</p>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="malignancy" value="no" checked class="accent-black w-4 h-4" /> <span class="text-sm font-medium">HayÄ±r</span></label>
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="malignancy" value="yes" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">Evet</span></label>
            </div>
          </div>

          <div class="rounded-xl border border-slate-200 p-4 bg-slate-50/30 hover:bg-slate-50 transition-colors">
            <label class="text-sm font-bold text-slate-800">KÃ¶tÃ¼ Yara Ä°yileÅŸmesi (Skar)</label>
            <p class="text-xs text-slate-500 mb-3 leading-snug">Ã–nceki kesilerde keloid, kabarÄ±k, kÄ±rmÄ±zÄ± veya geniÅŸlemiÅŸ iz.</p>
            <div class="flex gap-4">
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="keloid" value="no" checked class="accent-black w-4 h-4" /> <span class="text-sm font-medium">HayÄ±r</span></label>
              <label class="flex items-center gap-2 cursor-pointer bg-white px-3 py-2 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="keloid" value="yes" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">Evet</span></label>
            </div>
          </div>
        </div>

        <div id="dynamic-tummy" class="hidden rounded-xl border border-amber-200 bg-amber-50 p-5 shadow-sm">
          <div class="flex items-center gap-2 mb-2">
            <svg class="w-5 h-5 text-amber-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>
            <label class="text-sm font-bold text-amber-900">Ã–nceki Gebelik / Sezaryen</label>
          </div>
          <p class="text-sm text-amber-800 mb-3 leading-relaxed">KarÄ±n germe (Tummy Tuck) prosedÃ¼rÃ¼ iÃ§in karÄ±n kasÄ± durumunu deÄŸerlendirmek adÄ±na gereklidir.</p>
          <div class="flex gap-4">
            <label class="flex items-center gap-2 cursor-pointer bg-white px-4 py-2 rounded-lg border border-amber-200 hover:border-amber-400"><input type="radio" name="csection" value="no" checked class="accent-amber-600 w-4 h-4" /> <span class="text-sm font-medium">HayÄ±r</span></label>
            <label class="flex items-center gap-2 cursor-pointer bg-white px-4 py-2 rounded-lg border border-amber-200 hover:border-amber-400"><input type="radio" name="csection" value="yes" class="accent-amber-600 w-4 h-4" /> <span class="text-sm font-medium">Evet</span></label>
          </div>
        </div>

        <div>
          <label class="text-sm font-medium text-slate-700 mb-2 block">DiÄŸer hastalÄ±k veya ameliyat geÃ§miÅŸiniz (Serbest Metin)</label>
          <textarea id="medHistory" rows="3" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="Varsa geÃ§miÅŸ ameliyatlarÄ±nÄ±zÄ±, kronik hastalÄ±klarÄ±nÄ±zÄ± ve diÄŸer detaylarÄ± buraya yazÄ±nÄ±z..."></textarea>
        </div>
      </div>

      <div class="mt-8 flex justify-between">
        <button onclick="prevStep(2)" class="rounded-lg border border-slate-300 text-slate-700 px-6 py-3 text-sm font-medium hover:bg-slate-50 transition-colors">â† Geri</button>
        <button onclick="nextStep(2)" class="rounded-lg bg-black text-white px-6 py-3 text-sm font-bold hover:bg-slate-800 transition-colors shadow-md">Devam Et â†’</button>
      </div>
    </div>

    <div id="sec-3" class="hidden bg-white rounded-xl shadow p-8 mb-4">
      <h2 class="font-bold text-xl mb-1 text-slate-800">AlÄ±ÅŸkanlÄ±klar</h2>
      <p class="text-sm text-slate-500 mb-6">Cerrahi iyileÅŸme ve riski doÄŸrudan etkileyen yaÅŸam tarzÄ± bilgileri.</p>

      <div class="space-y-6">
        <div class="rounded-xl border border-slate-200 p-5 bg-slate-50/50">
          <div class="flex items-center gap-2 mb-3">
            <svg class="w-5 h-5 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
            <label class="text-base font-bold text-slate-800">Sigara / TÃ¼tÃ¼n KullanÄ±mÄ± *</label>
          </div>
          <p class="text-xs text-slate-500 mb-4">Nikotin, yara iyileÅŸmesini ve kan dolaÅŸÄ±mÄ±nÄ± ciddi ÅŸekilde bozar.</p>
          <div class="space-y-3">
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-slate-200 hover:border-slate-400"><input type="radio" name="smoking" value="never" checked class="accent-black w-5 h-5" onchange="toggleSmokeDetail()" /> <span class="text-sm font-medium">HiÃ§ kullanmadÄ±m</span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-slate-200 hover:border-slate-400"><input type="radio" name="smoking" value="quit_6m_plus" class="accent-black w-5 h-5" onchange="toggleSmokeDetail()" /> <span class="text-sm font-medium">BÄ±raktÄ±m â€” 6 aydan fazla Ã¶nce</span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-slate-200 hover:border-slate-400"><input type="radio" name="smoking" value="quit_recent" class="accent-black w-5 h-5" onchange="toggleSmokeDetail()" /> <span class="text-sm font-medium">BÄ±raktÄ±m â€” son 6 ay iÃ§inde <span class="text-amber-600 text-xs">(Risk devam edebilir)</span></span></label>
            <label class="flex items-center gap-3 cursor-pointer bg-white p-3 rounded-lg border border-slate-200 hover:border-slate-400"><input type="radio" name="smoking" value="active" class="accent-black w-5 h-5" onchange="toggleSmokeDetail()" /> <span class="text-sm font-bold text-slate-900">Aktif iÃ§iyorum / Elektronik sigara kullanÄ±yorum</span></label>
          </div>
          <div id="smoke-detail" class="hidden mt-4 pl-4 border-l-2 border-slate-200">
            <label class="text-sm font-medium text-slate-700 mb-1 block">Detay (GÃ¼nde kaÃ§ adet? / Tam olarak ne zaman bÄ±raktÄ±nÄ±z?)</label>
            <input id="smokeDetail" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black bg-white" placeholder="Ã–rn: 15 adet/gÃ¼n veya 3 ay Ã¶nce bÄ±raktÄ±m" />
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
          <div class="rounded-xl border border-slate-200 p-5 bg-slate-50/30">
            <label class="text-sm font-bold text-slate-800">Alkol TÃ¼ketimi</label>
            <div class="mt-4 space-y-2">
              <label class="flex items-center gap-3 cursor-pointer bg-white p-2.5 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="alcohol" value="none" checked class="accent-black w-4 h-4" /> <span class="text-sm font-medium">KullanmÄ±yorum</span></label>
              <label class="flex items-center gap-3 cursor-pointer bg-white p-2.5 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="alcohol" value="occasional" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">Sosyal (ara sÄ±ra)</span></label>
              <label class="flex items-center gap-3 cursor-pointer bg-white p-2.5 rounded border border-slate-200 hover:border-slate-400"><input type="radio" name="alcohol" value="regular" class="accent-black w-4 h-4" /> <span class="text-sm font-medium">DÃ¼zenli (haftada birkaÃ§ kez)</span></label>
            </div>
          </div>

          <div class="rounded-xl border border-slate-200 p-5 bg-slate-50/30">
            <label class="text-sm font-bold text-slate-800">BÃ¼yÃ¼k Kilo KaybÄ± (>15 kg)</label>
            <p class="text-xs text-slate-500 mb-4 leading-snug">Son 2 yÄ±l iÃ§inde (Diyet veya mide ameliyatÄ± ile).</p>
            <div class="flex gap-4 mt-2">
              <label class="flex items-center gap-3 cursor-pointer bg-white px-4 py-3 rounded-lg border border-slate-200 hover:border-slate-400"><input type="radio" name="majorWeightLoss" value="no" checked class="accent-black w-5 h-5" /> <span class="text-sm font-medium">HayÄ±r</span></label>
              <label class="flex items-center gap-3 cursor-pointer bg-white px-4 py-3 rounded-lg border border-slate-200 hover:border-slate-400"><input type="radio" name="majorWeightLoss" value="yes" class="accent-black w-5 h-5" /> <span class="text-sm font-medium">Evet</span></label>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-8 flex justify-between">
        <button onclick="prevStep(3)" class="rounded-lg border border-slate-300 text-slate-700 px-6 py-3 text-sm font-medium hover:bg-slate-50 transition-colors">â† Geri</button>
        <button onclick="nextStep(3)" class="rounded-lg bg-black text-white px-6 py-3 text-sm font-bold hover:bg-slate-800 transition-colors shadow-md">Devam Et â†’</button>
      </div>
    </div>

    <div id="sec-4" class="hidden bg-white rounded-xl shadow p-8 mb-4">
      <h2 class="font-bold text-xl mb-1 text-slate-800">Beklentileriniz ve Onay</h2>
      <p class="text-sm text-slate-500 mb-6">Operasyondan beklentileriniz ve yasal beyanÄ±nÄ±z.</p>

      <div class="mt-4">
        <label class="text-sm font-medium text-slate-700 mb-2 block">Beklentilerinizi kÄ±saca yazÄ±n *</label>
        <textarea id="expectations" rows="5" class="w-full rounded-lg border border-slate-300 p-3 text-sm focus:outline-none focus:border-black focus:ring-1 focus:ring-black" placeholder="Bu ameliyattan tam olarak ne bekliyorsunuz? Sizi en Ã§ok endiÅŸelendiren ÅŸey nedir?"></textarea>
      </div>

      <div class="mt-8 p-5 bg-slate-100 rounded-xl border border-slate-200">
        <div class="flex items-center gap-2 mb-3">
           <svg class="w-5 h-5 text-slate-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
           <h3 class="font-bold text-slate-800">Hukuki Beyan ve RÄ±za</h3>
        </div>
        <label class="flex items-start gap-4 cursor-pointer">
          <input type="checkbox" id="legalConsent" class="accent-black w-6 h-6 mt-0.5 flex-shrink-0" />
          <span class="text-sm text-slate-600 leading-relaxed">
            Bu dijital formda belirttiÄŸim tÃ¼m saÄŸlÄ±k geÃ§miÅŸimin, geÃ§irdiÄŸim hastalÄ±klarÄ±n, ameliyatlarÄ±n, alÄ±ÅŸkanlÄ±klarÄ±mÄ±n ve kullandÄ±ÄŸÄ±m ilaÃ§larÄ±n <strong>eksiksiz ve doÄŸru olduÄŸunu</strong> beyan ederim. Mevcut bir hastalÄ±ÄŸÄ±mÄ± veya ilacÄ±mÄ± gizlemem, yanlÄ±ÅŸ veya eksik bildirmem durumunda oluÅŸabilecek anestezi ve cerrahi komplikasyonlarda tÃ¼m tÄ±bbi ve hukuki sorumluluÄŸun ÅŸahsÄ±ma ait olduÄŸunu, bu beyanÄ±mÄ±n dijital zaman damgasÄ± ile kayÄ±t altÄ±na alÄ±ndÄ±ÄŸÄ±nÄ± kabul ediyorum.
          </span>
        </label>
      </div>

      <div class="mt-8 flex justify-between items-center">
        <button onclick="prevStep(4)" class="rounded-lg border border-slate-300 text-slate-700 px-6 py-3 text-sm font-medium hover:bg-slate-50 transition-colors">â† Geri</button>
        <button onclick="submitForm()" id="submitBtn" class="rounded-lg bg-black text-white px-8 py-4 text-base font-bold hover:bg-slate-900 transition-colors shadow-lg flex items-center gap-2">Formu GÃ¶nder <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></button>
      </div>
    </div>

    <div id="sec-success" class="hidden bg-white rounded-xl shadow-lg p-12 mb-6 text-center">
      <div class="w-20 h-20 bg-emerald-100 rounded-full flex items-center justify-center mx-auto mb-6">
        <svg class="w-10 h-10 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
      </div>
      <h2 class="text-2xl font-bold text-slate-800 mb-2">Formunuz BaÅŸarÄ±yla Ä°letildi</h2>
      <p class="text-slate-500 mt-2 text-base max-w-md mx-auto">Ã–n deÄŸerlendirme formunuz kliniÄŸimize gÃ¼venli bir ÅŸekilde ulaÅŸmÄ±ÅŸtÄ±r. Hekimimiz deÄŸerlendirmeyi yaptÄ±ktan sonra ekibimiz sizinle iletiÅŸime geÃ§ecektir.</p>
      <div class="mt-8 inline-flex flex-col items-center rounded-lg bg-slate-50 border border-slate-200 px-6 py-4">
        <span class="text-xs text-slate-400 uppercase tracking-wider font-medium mb-1">Vaka Takip ID</span>
        <span id="caseIdDisplay" class="font-mono text-lg font-bold text-slate-800 tracking-wider"></span>
      </div>
    </div>

    <div class="text-xs text-slate-400 text-center pb-8 leading-relaxed max-w-lg mx-auto">
      Â© 2024 SurgiCheck. TÃ¼m kayÄ±tlar HIPAA/KVKK uyumlu sunucularda saklanÄ±r ve sadece ilgili klinisyen tarafÄ±ndan incelenir. YanlÄ±ÅŸ beyan ameliyat kararÄ±nÄ± etkileyebilir.
    </div>

  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB1j6BthE6pSHzqW82dVaphyD2IiI03LN8",
      authDomain: "surgicheck-v3.firebaseapp.com",
      projectId: "surgicheck-v3",
      storageBucket: "surgicheck-v3.firebasestorage.app",
      messagingSenderId: "907975258387",
      appId: "1:907975258387:web:6e26d8deddbd8f52e22ae6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.getElementById("procedure").addEventListener("change", (e) => {
      const proc = e.target.value;
      const tummyBlock = document.getElementById("dynamic-tummy");
      if (proc === "Tummy Tuck") {
        tummyBlock.classList.remove("hidden");
      } else {
        tummyBlock.classList.add("hidden");
        document.querySelector('input[name="csection"][value="no"]').checked = true;
      }
    });

    function calcBMI() {
      let h = parseFloat(document.getElementById("heightCm").value);
      const w = parseFloat(document.getElementById("weightKg").value);
      const disp = document.getElementById("bmi-display");
      
      if (!h || !w) { disp.classList.add("hidden"); return null; }
      if (h < 3) { h = h * 100; } 
      
      const bmi = w / Math.pow(h / 100, 2);
      const note = bmi < 18.5 ? "(DÃ¼ÅŸÃ¼k kilolu)" : bmi < 25 ? "(Normal)" : bmi < 30 ? "(Kilolu)" : bmi < 35 ? "(Obez I)" : "(Obez II+)";
      
      document.getElementById("bmi-val").textContent = bmi.toFixed(1);
      document.getElementById("bmi-note").textContent = note;
      disp.classList.remove("hidden");
      return parseFloat(bmi.toFixed(1));
    }
    document.getElementById("heightCm").addEventListener("input", calcBMI);
    document.getElementById("weightKg").addEventListener("input", calcBMI);

    window.nextStep = function(from) {
      if (!validateStep(from)) return;
      document.getElementById("sec-" + from).classList.add("hidden");
      document.getElementById("sec-" + (from + 1)).classList.remove("hidden");
      updateDots(from + 1);
      window.scrollTo({ top: 0, behavior: "smooth" });
    };

    window.prevStep = function(from) {
      document.getElementById("sec-" + from).classList.add("hidden");
      document.getElementById("sec-" + (from - 1)).classList.remove("hidden");
      updateDots(from - 1);
      window.scrollTo({ top: 0, behavior: "smooth" });
    };

    function updateDots(active) {
      for (let i = 1; i <= 4; i++) {
        const dot = document.getElementById("dot-" + i);
        if (i < active) {
          dot.className = "w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-emerald-600 text-white flex-shrink-0 transition-colors";
          dot.textContent = "âœ“";
        } else if (i === active) {
          dot.className = "w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-black text-white flex-shrink-0 transition-colors shadow-sm";
          dot.textContent = i;
        } else {
          dot.className = "w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold bg-slate-200 text-slate-500 flex-shrink-0 transition-colors";
          dot.textContent = i;
        }
      }
    }

    function validateStep(step) {
      if (step === 1) {
        const fields = ["procedure", "revision", "fullName", "phone", "email", "age", "heightCm", "weightKg"];
        for (const f of fields) {
          if (!document.getElementById(f).value.trim()) {
            showAlert("err", "LÃ¼tfen tÃ¼m zorunlu alanlarÄ± doldurun.");
            return false;
          }
        }
      }
      if (step === 4) {
        if (!document.getElementById("expectations").value.trim()) {
          showAlert("err", "LÃ¼tfen beklentilerinizi yazÄ±n."); return false;
        }
        if (!document.getElementById("legalConsent").checked) {
          showAlert("err", "Formu gÃ¶ndermek iÃ§in lÃ¼tfen Hukuki Beyan metnini okuyup onaylayÄ±nÄ±z."); 
          return false;
        }
      }
      return true;
    }

    window.toggleSmokeDetail = function() {
      const val = document.querySelector('input[name="smoking"]:checked')?.value;
      const d = document.getElementById("smoke-detail");
      d.classList.toggle("hidden", val === "never" || val === "quit_6m_plus");
    };

    window.submitForm = async function() {
      if (!validateStep(4)) return;

      const btn = document.getElementById("submitBtn");
      btn.disabled = true;
      btn.innerHTML = `<svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Kaydediliyor...`;

      try {
        const bmi = calcBMI();
        let height = parseFloat(document.getElementById("heightCm").value);
        if (height < 3) { height = height * 100; } 
        
        const procName = document.getElementById("procedure").value;

        const payload = {
          clinic: { name: "Leo Klinik" },
          patient: {
            fullName: document.getElementById("fullName").value.trim(),
            phone: document.getElementById("phone").value.trim(),
            email: document.getElementById("email").value.trim(),
            age: Number(document.getElementById("age").value),
          },
          procedure: {
            name: procName,
            revision: document.getElementById("revision").value === "yes"
          },
          anthropometrics: {
            heightCm: height,
            weightKg: Number(document.getElementById("weightKg").value),
            bmi: bmi,
          },
          risks: {
            cardiac: document.querySelector('input[name="cardiac"]:checked')?.value === "yes",
            dvt: document.querySelector('input[name="dvt"]:checked')?.value === "yes",
            diabetes: document.querySelector('input[name="diabetes"]:checked')?.value === "yes",
            ht: document.querySelector('input[name="ht"]:checked')?.value === "yes",
            activeMalignancy: document.querySelector('input[name="malignancy"]:checked')?.value === "yes",
            keloid: document.querySelector('input[name="keloid"]:checked')?.value === "yes",
            csection: procName === "Tummy Tuck" ? (document.querySelector('input[name="csection"]:checked')?.value === "yes") : false,
            
            medBloodThinners: document.getElementById("med_bloodThinners").checked,
            medOcp: document.getElementById("med_ocp").checked,
            medGlp1: document.getElementById("med_glp1").checked,
            medAcne: document.getElementById("med_acne").checked,
            medPsych: document.getElementById("med_psych").checked,
            medSteroid: document.getElementById("med_steroid").checked,
            medOther: document.getElementById("med_other").value.trim() || null,

            smoking: document.querySelector('input[name="smoking"]:checked')?.value ?? "never",
            smokeDetail: document.getElementById("smokeDetail").value.trim() || null,
            alcohol: document.querySelector('input[name="alcohol"]:checked')?.value ?? "none",
            majorWeightLoss: document.querySelector('input[name="majorWeightLoss"]:checked')?.value === "yes",
          },
          medHistory: document.getElementById("medHistory").value.trim() || null,
          expectations: document.getElementById("expectations").value.trim(),
          legalConsentVerified: document.getElementById("legalConsent").checked,
          clinician: {
            asa: null,
            smokingVerified: null,
            anticoagVerified: null,
            decision: null,
            rationale: null,
            name: null,
            examNote: null,
            validations: {}
          },
          status: "patient_submitted",
          createdAt: serverTimestamp(),
          updatedAt: serverTimestamp()
        };

        const ref = await addDoc(collection(db, "cases"), payload);

        document.getElementById("sec-4").classList.add("hidden");
        document.getElementById("sec-success").classList.remove("hidden");
        document.getElementById("caseIdDisplay").textContent = ref.id;
        window.scrollTo({ top: 0, behavior: "smooth" });

      } catch (err) {
        console.error(err);
        showAlert("err", "KayÄ±t sÄ±rasÄ±nda hata oluÅŸtu. Ä°nternet baÄŸlantÄ±nÄ±zÄ± kontrol edip tekrar deneyin.");
        btn.disabled = false;
        btn.innerHTML = `Formu GÃ¶nder âœ“`;
      }
    };

    function showAlert(type, msg) {
      const el = document.getElementById("alert");
      el.classList.remove("hidden");
      el.className = "mb-4 rounded-xl p-4 text-sm font-medium shadow-sm flex items-center gap-2 " + (type === "ok"
        ? "bg-emerald-50 text-emerald-800 border border-emerald-200"
        : "bg-rose-50 text-rose-900 border border-rose-200");
      el.innerHTML = (type === "ok" ? '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>' : '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>') + msg;
      setTimeout(() => el.classList.add("hidden"), 4000);
    }
    window.showAlert = showAlert;
  </script>
</body>
</html>
